#! /usr/bin/env bash

set -e

root=${1:-$PWD}

for dir in "${root}"/lua*; do
  if [ -d "${dir}" ]; then
    echo "Installing in ${dir}..."
    "${dir}/bin/luarocks" make rockspec/cosy-editor-env-master-1.rockspec
    "${dir}/bin/luarocks" make rockspec/cosy-editor-master-1.rockspec
  fi
done

for dir in "${root}"/lua*; do
  if [ -d "${dir}" ]; then
    echo "Testing in ${dir}..."
    "${dir}/bin/cosy-check-editor"
  fi
done
